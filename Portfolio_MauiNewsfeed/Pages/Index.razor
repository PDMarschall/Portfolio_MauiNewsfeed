@page "/"
@using Portfolio_MauiNewsfeed.Filtering;
@inject NewsfeedFilter newsfeedFilter

<TabControl>
    <TabPage Text="Seneste Nyt">
        <br />
        <Newsfeed FeedUrl="https://www.dr.dk/nyheder/service/feeds/senestenyt" IsFiltered="_enableFilter" Whitelist="_whitelist" Blacklist="_blacklist" />
    </TabPage>
    <TabPage Text="Indland">
        <br />
        <Newsfeed FeedUrl="https://www.dr.dk/nyheder/service/feeds/indland" IsFiltered="_enableFilter" Whitelist="_whitelist" Blacklist="_blacklist" />
    </TabPage>
    <TabPage Text="Udland">
        <br />
        <Newsfeed FeedUrl="https://www.dr.dk/nyheder/service/feeds/udland" IsFiltered="_enableFilter" Whitelist="_whitelist" Blacklist="_blacklist" />
    </TabPage>
    <TabPage Text="Penge">
        <br />
        <Newsfeed FeedUrl="https://www.dr.dk/nyheder/service/feeds/penge" IsFiltered="_enableFilter" Whitelist="_whitelist" Blacklist="_blacklist" />
    </TabPage>
</TabControl>

@code {

    private bool _enableFilter;
    private List<string> _whitelist { get; set; }
    private List<string> _blacklist { get; set; }

    protected override void OnParametersSet()
    {
        _enableFilter = Preferences.Get("EnableFilter", false);
        _whitelist ??= new List<string>();
        _blacklist ??= new List<string>();

        if (_enableFilter && Preferences.Get("ActiveFilter", "None") != "None")
        {
            _whitelist.AddRange(newsfeedFilter.UserWhitelist);
            _blacklist.AddRange(newsfeedFilter.UserBlacklist);
        }
        else
        {
            _whitelist.Clear();
            _blacklist.Clear();
        }

        base.OnParametersSet();
    }

}